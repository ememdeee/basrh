var DealerCenter;!function(e){!function(e){!function(e){var t=function(){function e(){var e=jQuery;e("#DWSSearchSettingsKeyword").length&&(this.setting=JSON.parse(e("#DWSSearchSettingsKeyword").html())),e("#DWSSearchSettings").length&&(this.setting=JSON.parse(e("#DWSSearchSettings").html()))}return e.prototype.init=function(){this.initializeControl()},e.prototype.initializeControl=function(){var e=this;if((o=jQuery)("#DWSSearchSettings").length||o("#DWSSearchSettingsKeyword").length){var t=o("#DWSSearchDefaultFields form"),n=this.setting.vehicleListingUrl;if("default_search_form"==this.setting.searchForm&&(this.locationDropDown=o(".dws-search-location-list select",this.container),this.makeDropDown=o(".dws-search-make-list select",this.container),this.modelDropDown=o(".dws-search-model-list select",this.container),o.ajax({url:"/wp-admin/admin-ajax.php",type:"post",data:{action:"dws_inventory_search_service",requestType:"get_locations",advFilterId:this.setting.advFilterId},success:function(t){t.forEach(function(t){e.locationDropDown.append(o("<option>").val(t.Value).html(t.Value))})},beforeSend:function(){o(".loading-container").show()},complete:function(){o(".loading-container").hide()}}),this.handleVehicleCounter(this.locationDropDown.val(),this.makeDropDown.val()),o.ajax({url:"/wp-admin/admin-ajax.php",type:"post",data:{action:"dws_inventory_search_service",requestType:"get_makes",advFilterId:this.setting.advFilterId},success:function(t){t.forEach(function(t){e.makeDropDown.append(o("<option>").val(t.Value).html(t.Value))})},beforeSend:function(){o(".loading-container").show()},complete:function(){o(".loading-container").hide()}}),1==this.setting.showAllModels&&o.ajax({url:"/wp-admin/admin-ajax.php",type:"post",data:{action:"dws_inventory_search_service",requestType:"get_models",advFilterId:this.setting.advFilterId},success:function(t){t.forEach(function(t){e.modelDropDown.append(o("<option>").val(t.Value).html(t.Value))})},beforeSend:function(){o(".loading-container").show()},complete:function(){o(".loading-container").hide()}}),this.locationDropDown.change(function(){e.handleLocationChange(e.locationDropDown.val())}),this.makeDropDown.change(function(){e.handleMakeChange(e.locationDropDown.val(),e.makeDropDown.val())}),t.on("submit",function(t){t.preventDefault(),e.defaultLayoutSubmit()})),o("#DWSSearchSettingsKeyword").length){"yes"==this.setting.vehicleCountStatus&&o.ajax({url:"/wp-admin/admin-ajax.php",type:"post",data:{action:"dws_inventory_search_service",requestType:"get_locations",advFilterId:this.setting.advFilterId},success:function(e){e.forEach(function(e){o(".dws-search-by-keyword-container").each(function(){o(this).append('<span class="dws-search-vehicle-count">'+e.Count+"</span>")})})}}),o(".dws-inventory-search.search-by-keyword").on("submit",function(e){e.preventDefault(),"/"!=n[n.length-1]&&(n+="/");var t=o(this).data("keyword-selector"),a=o("#"+t).val();document.location.href=""==a?n:n+"?search="+a}),o("#searchBoxModal .button-search").on("click",function(e){e.preventDefault(),""==o("#searchBoxModal .dws-search-keyword").val()?o(".popup-search-validation").show():o("#searchBoxModal form").submit()});var o=jQuery;if(window.hasOwnProperty("webkitSpeechRecognition")){var a=o('<button class="btn-voice search-voice-button" type="button" title="Voice Search" aria-label="Voice Search"><i class="icon dws-icomoon-mic" aria-hidden="true"></i></button>');o(".microphone-true").after(a),o(".microphone-true").addClass("voice-search")}else o(".dws-inventory-search").addClass("no-voice-search");o(".dws-inventory-search").on("click",".search-voice-button",function(e){var t=new(0,window.webkitSpeechRecognition);t.continuous=!1,t.interimResults=!1,t.lang="en-US",t.start(),o(this).addClass("voice-search-enabled"),o("i",this).addClass("dws-icomoon-spinner4").removeClass("dws-icomoon-mic"),t.onresult=function(e){o(".microphone-true").val(e.results[0][0].transcript),o(".voice-search-enabled i").removeClass("dws-icomoon-spinner4").addClass("dws-icomoon-mic"),t.stop(),o(".dws-inventory-search").submit()},t.onerror=function(e){o(".voice-search-enabled i").removeClass("dws-icomoon-spinner4").addClass("dws-icomoon-mic"),o(".search-voice-button").removeClass("voice-search-enabled"),t.stop()},t.onend=function(e){o(".voice-search-enabled i").removeClass("dws-icomoon-spinner4").addClass("dws-icomoon-mic"),o(".search-voice-button").removeClass("voice-search-enabled"),t.stop()}})}}},e.prototype.handleVehicleCounter=function(e,t){var n=jQuery;"yes"==this.setting.vehicleCountStatus&&n.ajax({url:"/wp-admin/admin-ajax.php",type:"post",data:{action:"dws_inventory_search_service",requestType:"get_vehicle_count",make:t,location:e,advFilterId:this.setting.advFilterId},success:function(e){var t=0;e.forEach(function(e){t+=parseInt(e.Count)}),n(".dws-search-by-default-field-wrapper").each(function(){n(this).append('<span class="dws-search-vehicle-count">'+t+"</span>")})}})},e.prototype.handleLocationChange=function(e){var t=this,n=jQuery;n("option",this.makeDropDown).each(function(e,t){e>0&&n(t).remove()}),n("option",this.modelDropDown).each(function(e,t){e>0&&n(t).remove()}),n.ajax({url:"/wp-admin/admin-ajax.php",type:"post",data:{action:"dws_inventory_search_service",requestType:"get_makes",location:e,advFilterId:this.setting.advFilterId},success:function(e){var o=0;e.forEach(function(e){o+=parseInt(e.Count),t.makeDropDown.append(n("<option>").val(e.Value).html(e.Value)),"yes"==t.setting.vehicleCountStatus&&n("body").find(".dws-search-vehicle-count").text(o)})},beforeSend:function(){n(".loading-container").show()},complete:function(){n(".loading-container").hide()}})},e.prototype.handleMakeChange=function(e,t){var n=this,o=jQuery;o("option",this.modelDropDown).each(function(e,t){e>0&&o(t).remove()}),o.ajax({url:"/wp-admin/admin-ajax.php",type:"post",data:{action:"dws_inventory_search_service",requestType:"get_models",make:t,location:e,advFilterId:this.setting.advFilterId},success:function(e){var t=0;e.forEach(function(e){t+=parseInt(e.Count),n.modelDropDown.append(o("<option>").val(e.Value).html(e.Value)),"yes"==n.setting.vehicleCountStatus&&o("body").find(".dws-search-vehicle-count").text(t)})},beforeSend:function(){o(".loading-container").show()},complete:function(){o(".loading-container").hide()}})},e.prototype.defaultLayoutSubmit=function(){var e=jQuery,t=this.setting.vehicleListingUrl;"/"!=t[t.length-1]&&(t+="/");var n=e(".dws-search-location-list select",this.container),o=e(".dws-search-location-list select option:selected",this.container),a=e(".dws-search-make-list select",this.container),i=e(".dws-search-model-list select",this.container),s=e(".dws-search-min-price",this.container),r=e(".dws-search-max-price",this.container),c=parseInt(s.val()),l=parseInt(r.val()),d=null!=n.val()?n.val():"",h=null!=o.html()?o.html():"",u=a.val(),p=i.val();"Make"==u&&(u=""),"Model"==p&&(p=""),"Location"==d&&(d="");var m=this.buildSrpQueryString(d,h,u,p,c,l),v=this.buildSrpPath(u,p);if(""==u||""==p)var w=t+(""!=m?"?"+m:"");else w=t+v+(""!=m?"?"+m:"");void 0!==w&&""!=w&&(document.location.href=w)},e.prototype.buildSrpPath=function(e,t){jQuery;var n="";return this.setting.useQueryParameter||!0===this.setting.isFrontPage||""!=e&&(n=n+encodeURIComponent(e).toLowerCase()+"/",""!=t&&(n=n+encodeURIComponent(t).toLowerCase()+"/")),n},e.convertVehicleClass=function(e,t){void 0===e&&(e="numtochar");var n="";switch(e){case"numtostring":"1"==t?n="New":"2"==t&&(n="Used"),"3"==t&&(n="Certified");break;case"chartostring":"n"==t?n="New":"u"==t&&(n="Used"),"c"==t&&(n="Certified");break;case"numtochar":default:"1"==t?n="n":"2"==t&&(n="u"),"3"==t&&(n="c")}return n},e.prototype.buildSrpQueryString=function(e,t,n,o,a,i){var s="",r=function(e){return""!=e?"&":""};return this.setting.useQueryParameter?this.setting.showAllModels?(""!=e&&(s="location="+encodeURIComponent(e).toLowerCase()+"&dealername="+encodeURIComponent(t).toLowerCase()),""!=n&&(s=s+r(s)+"make="+encodeURIComponent(n).toLowerCase()),""!=o&&(s=s+r(s)+"model="+encodeURIComponent(o).toLowerCase())):(""!=e&&(s="location="+encodeURIComponent(e).toLowerCase()+"&dealername="+encodeURIComponent(t).toLowerCase()),""!=n&&(s=s+r(s)+"make="+encodeURIComponent(n).toLowerCase(),""!=o&&(s=s+r(s)+"model="+encodeURIComponent(o).toLowerCase()))):this.setting.showAllModels&&""==n&&""!=o?s=s+r(s)+"model="+encodeURIComponent(o).toLowerCase():(""!=e&&(s="location="+encodeURIComponent(e).toLowerCase()+"&dealername="+encodeURIComponent(t).toLowerCase()),""!=n&&(s=s+r(s)+"make="+encodeURIComponent(n).toLowerCase(),""!=o&&(s=s+r(s)+"model="+encodeURIComponent(o).toLowerCase()))),!isNaN(a)&&a>0&&(s=s+r(s)+"price_min="+a),!isNaN(i)&&i>0&&(s=s+r(s)+"price_max="+i),1==this.setting.isFrontPage&&(s=s.replace("make=","Make=").replace("model=","Model=")),s},e.prototype.defaultVehicleCounter=function(){var e=jQuery;e.ajax({url:"/wp-admin/admin-ajax.php",type:"post",data:{action:"dws_inventory_search_service",requestType:"get_locations",advFilterId:this.setting.advFilterId},success:function(t){t.forEach(function(t){e(".dws-search-field-wrapper").each(function(){e(this).append('<span class="dws-search-vehicle-count">'+t.Count+"</span>")})})}})},e}();e.dwsVehicleSearchDefault=t}(e.Plugins||(e.Plugins={}))}(e.WebSite||(e.WebSite={}))}(DealerCenter||(DealerCenter={})),jQuery(function(){(new DealerCenter.WebSite.Plugins.dwsVehicleSearchDefault).init()});